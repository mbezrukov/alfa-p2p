= REST Cards
:toc: left
:source-highlighter: highlightjs

[[Overview]]
== Описание
Сервис предназначен для работы с объектом Card.

=== JSON schema

https://github.com/mbezrukov/alfa-p2p/blob/master/cards-json-schema[JSON schema] 

=== Параметры объекта Cards
|===
| Параметр | Тип | Описание

| id
| String
| ID карты

| direction
| String
| Направление перевода (sender - карта списания, recipient - карта зачисления, both - оба варианта)

| name
| String
| Название

| alfabank
| Boolean
| Карта Альфа-Банка? (true/false/null - да/нет/нет)

| number
| String
| Номер карты

| expirationYear
| Integer
| Год окончания срока действия

| expirationMonth
| Integer
| Месяц окончания срока действия

| lastTransactionDate
| Date
| Дата последней транзакции (YYYY-MM-DD)

| paymentSystem
| String
| Платежная система

3+| Account

| account
| Object
| Информация по основному счету

| href
| String
| Строка запроса метода GET /accounts

| balance
| Integer
| Остаток по основному счету

3+| Currency

| currency
| Object
| Информация по валюте основного счета

| href
| String
| Строка запроса метода GET /currencies

| code
| String
| Мнемоника валюты основного счета

| description
| String
| Название валюты основного счета

3+| Bank

| bank
| Object
| ИИнформация о банке, выпустившему карту

| href
| String
| Строка запроса метода GET /banks/byCardId/{cardId}

| name 
| String
| Название банка

| countryCode
| String
| Код страны

| color
| String
| Цвет банка

|===

=== Пример объекта
----
{
  "object": "list",
  "data": [
    {
      "id": "1",
      "direction": "sender",
      "name": null,
      "alfabank": false,
      "number": "5154 **** 4025",
      "expirationYear": "15",
      "expirationMonth": "07",
      "lastTransactionDate": "2015-12-15",
      "paymentSystem": "MC",
        "account": {
        "href": "http://.../accounts/...",
        "balance": "15250.50",
        "currency": {
          "href": "http://.../currency/...",
          "code": "USD",
          "description": "Доллар США"
        }
      },
      "bank": {
        "href": "http://.../banks/...",
        "code": "0000001",
        "name": "Сбербанк",
        "countryCode": "12",
        "color": "#000008"
      }
    },
    {...}
  ]
}
----

[[overview-http-verbs]]
== Список методов

|===
| Метод | Описание

| `GET /cards`
| Получение списка карт пользователя

| `GET /cards/{cardId}`
| Получение информации о карте пользователя по ID

| `PATCH /cards/{cardId}`
| Редактирование параметров карты в системе

|===


[[resources-cards-get]]
=== Метод GET /cards


===== Параметры заголовков запросов
|===
| Параметр | Обязательность | По умолчанию | Описание | Тип

| customerId
| Mandatory
| ---
| Мнемоника пользователя и мнемоника местоположения
| String

| applicationId
| Mandatory
| ---
| ID приложения
| String

| mode
| Mandatory
| ---
| Режим работы ("all" - карты приложения + карты Альфа-Банка)
| String

|===


===== Параметры строки запроса
|===
| Параметр | Обязательность | По умолчанию | Описание | Тип

| verificationMethod
| Optional
| "3DSecure"
| Статус верификации карты ("3DSecure", "hold", "notverify")
| String

| deleted
| Optional
| false
| Включать карты, удаленные пользователем? (true/false)
| Boolean

| blocked
| Optional
| false
| Включать заблокированные карты? (true/false)
| Boolean

| active
| Optional
| false
| Включать неактивные и просроченные карты? (true/false)
| Boolean

|===

==== Получение списка карт в поле карты списания
....
Дано:
  клиент находится на странице перевода.
Когда:
  клиент кликает в поле ввода карты списания.
Тогда:
  выпадает список карт: карты Альфа-Банка клиента (active = true и alfabank = true) и 
  те, с которых он ранее делал переводы (active = true и alfabank = false и direction = sender).
....
===== Example request

GET `http://.../cards?verificationMethod=3DSecure&deleted=false&blocked=false&active=true&direction=sender`

===== Example response
----
{
  "object": "list",
  "data": [
    {
      "id": "1",
      "direction": "sender",
      "name": null,
      "alfabank": false,
      "number": "5154 **** 4025",
      "expirationYear": "15",
      "expirationMonth": "07",
      "lastTransactionDate": "2015-12-15",
      "paymentSystem": "MC",
        "account": {
        "href": "http://.../accounts/...",
        "balance": "15250.50",
        "currency": {
          "href": "http://.../currency/...",
          "code": "USD",
          "description": "Доллар США"
        }
      },
      "bank": {
        "href": "http://.../banks/...",
        "code": "0000001",
        "name": "Сбербанк",
        "countryCode": "12",
        "color": "#000008"
      }
    },
    {...}
  ]
}
----

==== Получение списка карт в поле карты зачисления
....
Дано:
  клиент находится на странице перевода.
Когда:
  клиент кликает в поле ввода карты зачисления.
Тогда:
  выпадает список карт: карты Альфа-Банка клиента (active = true и alfabank = true) и 
  те, на которые он ранее делал переводы (active = true и alfabank = false и direction = recipient).
....
===== Example request

GET http://.../cards?verificationMethod=3DSecure&deleted=false&blocked=false&active=true&direction=recipient

===== Example response

include::{generated}/cards-get-recipientcards/response.asciidoc[]


[[resources-cards-byCardId]]
=== Метод GET /cards/{cardId}


===== Параметры заголовков запросов
|===
| Параметр | Обязательность | По умолчанию | Описание | Тип

| customerId
| Mandatory
| ---
| Мнемоника пользователя и мнемоника местоположения
| String

| applicationId
| Mandatory
| ---
| ID приложения
| String

|===


===== Параметры строки запроса
|===
| Параметр | Обязательность | По умолчанию | Описание | Тип

| Id
| Mandatory
| ---
| ID карты
| String

|===


==== Получение параметров заданной карты 
....
Клиент получает все данные по своей карте (id = ...)
....
===== Example request

include::{generated}/cards-get-byid/request.asciidoc[]

===== Example response

include::{generated}/cards-get-byid/response.asciidoc[]


[[resources-cards-patch]]
=== Метод PATCH /cards/{cardId}

===== Параметры заголовков запросов
|===
| Параметр | Обязательность | По умолчанию | Описание | Тип

| customerId
| Mandatory
| ---
| Мнемоника пользователя и мнемоника местоположения
| String

| applicationId
| Mandatory
| ---
| ID приложения
| String

|===


===== Параметры строки запроса
|===
| Параметр | Обязательность | По умолчанию | Описание | Тип

| Id
| Mandatory
| ---
| ID карты
| String

|===


==== Редактирование названия карты
....
Дано:
  клиент кликает на псевдоссылку с названием карты.
Когда:
  вводит новое название карты (name = ...)
Тогда:
  сохраняется новое название карты.
....
===== Example request

include::{generated}/cards-patch-name/request.asciidoc[]

===== Example response

include::{generated}/cards-patch-name/response.asciidoc[]
